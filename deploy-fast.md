# 实现环境的快速部署

#### 目标

> 能够实现快速编排部署一套完整且可正常使用的环境。

#### 依赖条件

---

* 基础环境的一致性（包括：网络、计算、存储及操作系统内核等）

* 使用经过验证的对应安装包及配置模板（或元数据）

* 自动化平台或脚本

#### 步骤

---

![](/assets/deploy.png)

1. 基础环境准备

```
- 安装前准备（保证基础资源层的一致性）：包括网络检测、防火墙配置、系统内核升级、工具安装、时间同步等。
- 依赖组件安装（保证环境依赖服务的一致性）：包括dns服务、docker服务、kubernetes集群的安装配置。
```

> 使用kubernetes 可以大大降低基础环境的差异，可以较好的保证环境一致性（内置dns服务、配置中心，可以对虚拟机资源统一调度，无需关注每台节点的资源差异）。

2. 中间件服务部署

```
redis\mysql\es等自动化部署，并且每个组件的安装都有对应的安装状态，以便及时check。
```

3. 数据初始化（保证基础数据的一致性）

```
对sql脚本、版本补丁进行自动化执行，同时输出完成状态。
```

4. 服务部署

```
- 拉取对应版本的元数据模板（由CI交付，保证各环境一致）：模板中包括image url、依赖及配置。
- 执行部署：由k8s 解析并创建对应服务，且自动管理服务的资源分配和健康状态。
```

5. check & test

```
- 排除安装过程中的异常后，自动触发checklist进行整体环境服务的健康检查。
- 触发自动化测试进行全系统测试。
```

#### 补充

```
以上安装包、脚本补丁及自动化工具并非一次性可以准备完成，但可以通过多次测试及时调整，最终落地下来。
```



