# 压测分析

#### 1. 背景

```
缩减生产多余节点，提高生产利用率
```

#### 2. 压测条件

| **环境** | **压测服务** | **并发** | **节点数** | **jmx** | 时间 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 压测环境 | customize | 200 | 2 | 2g |  |
| 压测环境 | customize | 300 | 2 | 4g | 12:00~13:00 |
| 压测环境 | customize | 400 | 2 | 4g | 19:00~20:00 |

#### 3. 压测场景：

* 环境：Tencent压测环境
* 工具：CAT、jmxtrnas、loadrunner
* 业务场景：

#### 4. 压测过程及记录

条件一：   并发200

```
    cat没数据了
```

条件二： 并发300, 节点 2

> 测试环境： 平均 qps 310 ，最大qps为 25000/60s=410+  r/s    ![](/assets/cat300-1.png)![](/assets/cat300-2.png)

条件三：并发 400 ，节点 2

> 平均qps420 ，最大qps 30000/60=500 r/s![](/assets/cat400-2.png)![](/assets/cat400-03.png)![](/assets/jmx400-1.png)

#### 5. 生产对比

> 生产环境 ： 10个主节点，配置：4u8g
>
> 分析了最近一个月内高峰期为 10:00~11:00,15:00~16:00;最大峰值在12月10日的10:00~11:00;

生产环境：峰值点总qps2936；单节点平均qps 290, 最大qps 20000/60=330 r/s![](/assets/cat300-p1.png)![](/assets/cat300-p2.png)

#### 6. 分析

* 如上图，由于压测环境资源有限，在并发超过400时，其它服务达到瓶颈；故没能真正压测到服务的最大qps。
* 在负载为400，customize服务qps最大到达500+，是目前生产单服务最大qps（分析最近一个月的高峰qps）的1.6倍；

#### 7. 结论

```
根据以上分析，承载生产最大qps只需6个节点；所有建议将生产customize节点数降到6个节点。
```

#### 8.补充

* 如上由于压测环境资源问题，未能压测到customize的最大qps；
* 压测环境的customize服务和其它服务共用，对结果有一定影响；
* 生产的服务资源比压测环境充足，为压测服务的2倍。



