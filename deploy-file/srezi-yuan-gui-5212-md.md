# 生产资源合理化分析

## 1. 公式

* 生产所需节点数 = 生产QPS\(总\)/单服务最大QPS \* 性能比率 

```
说明: 
  单服务最大QPS由压测产生(即: 服务可以正常响应的最大QPS,且CPU<80%,minor gc频率>10s)
  性能比率=分析服务在生产环境性能/当前压测环境性能 (综合考虑云环境\服务配置\服务所在vm情况等)
```

* 生产QPS\(总\) = 统计月每日高峰时间点QPS之和/\(高峰时间点数\*统计月天数\)

```
说明:
  qps按每小时为单位进行统计(即: qps/h)
  暂定高峰时间点数为3,后根据实际数据统计做调整
```

* 日高峰时间点= 日最大QPS排序\(大到小\),按月统计最佳高峰点\(h\)

## 2. 其它

* qps数据从CAT中提取,并需要根据接口调用分布排除QPS较大但是对服务性能影响很小的接口;

        如下图接口,占用了20%的qps,但是平均响应只有4.5ms.

![](/assets/import.png)

* 在压测阶段对比的qps值也是在去除上面接口后的结果.

## 



